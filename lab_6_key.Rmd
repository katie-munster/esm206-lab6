---
title: "Lab 6"
author: "Katie Munster"
date: "11/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(palmerpenguins)
library(broom)
library(equatiomatic)
```

## Rank based test exxample

Mann-Whitney U (non-parametric alternative to an unpaired 2-sample t-test).

H0: Our samples are drawn from populations with equal ranks (or medians)
HA: Ranks are not equal (or, medians are not equal)

### Create samples

`set.seed()` to create "pseudorandom, but reproducible samples"

```{r}
set.seed(1414) # setting the seed gives us all the same starting point. we all get the same output
gp_1 <- sample.int(20, size = 15, replace = TRUE)
# 20 is the highest possible value
# with sample replacement so it is a random sample

set.seed(1424)
gp_2 <- sample.int(30, size = 15, replace = TRUE)
# run gp_2 in the console to see its values. we all got the same random sample
```

Take a quick look at the distributions using the `hist()` function. 

```{r}
hist(gp_1)
# not screaming normality. only 15 observations but doesnt seem like it is definitely from a normal distribution
hist(gp_2)
# also does not scream normal distribution. looks more like an uniform distribution

# leads me to think it might be worth to do a more conservative rank-based test for these values
```

Try a t-test so we can compare the results:

```{r}
ttest <- t.test(gp_1, gp_2)
# unpaired t test
# If these data were paired, I can just add the argument 'paired = "TRUE"' within the t.test() function.
# t test is  a question about means differences

# This p-value means there is a 19.8% chance that there are two samples with means at least this different if they come from populations of the same mean.
```

This p-value means that IF our samples are drawn from populations with the same mean (i.e. if the null hypothesis is true), there is `r round(ttest$p.value, 2)` probability of finding sample means *at least as different* as mine by random chance.

[A more comprehensive explanation of difference between groups...actually means, data spread, effect size]...there is no significant difference (t(df) = t-statistic value, p = ).

(degrees of freedom is a measure of pool sample size)

### Mann Whitney U rank based test

We use the `wilcox.test()` function to perform a two-sample rank-based test.

```{r}
mwu <- wilcox.test(gp_1, gp_2)
# type mwu into console to see the values
# W or U is the statistic value
#?wilcox.test in the console to learn more about the variables
```

This p-value means that IF our samples are drawn from populations with the same median (i.e. if the null hypothesis is true), there is `r round(ttest$p.value, 2)` probability of finding sample medians *at least as different* as mine by random chance.

No significant difference in medians (Mann-Whitney U; U = `r mwu$statistic`, p = `r round(mwu$p.value, 2)`)

The medians of group A (M = 22.4 g) and group B (M = 31.2 g) did not differ significantly (Mann Whitney U, ...)

## Simple linear regression

Two *continuous quantitative* variables that you are trying to understand the relationship between, and you think that a linear relationship makes sense.

Use the `penguins` data from {palmerpenguins}, exploring flipper length (x) versus body mass (y).

```{r}
# Use View(penguins) to look at it
# Make an exploratory scatterplot of penguin flipper length (x-axis) versus body mass (y-axis)

ggplot(data = penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point() +
  geom_smooth(method = "lm") # adds the linear trendline

# Looks like a linear relationship

# y = mx + b
# y = B1*x + B0 + Error
# m = slope
# b = intercept

# body mass (g) = B1(flipper length(mm)) + B0
```

### Find the model estimates (coefficients)

Use the `lm()` function for linear model.

body_mass_g ~ <<< tilde (not a minus sign)

```{r}
penguin_lm <- lm(body_mass_g ~ flipper_length_mm, data = penguins)

# body_mass (g) = 49.69*(flipper length (mm)) - 5780.83
# units of 49.69 is g/mm
# slope: on average, for a 1 mm increase in flipper length, that is associated with a 49.69 g increase in body mass on average
# intercept: units has to be in g
# the intercept is the mass of the penguin without flippers (flipper length = 0 mm)
# negative mass isn't even possible



# in console, summary(penguin_lm)
# reject based on p-values. significantly non-zero coefficients


# ?lm
```

Model coefficients: `r penguin_lm$coefficients`
Flipper length coefficient: `r penguin_lm$coefficients[2]`

### Use `broom::tidy()` to get a tidy output from lm()

```{r}
penguin_lm_tidy <- tidy(penguin_lm)

penguin_lm_tidy

penguin_lm_tidy$estimate[2]
```

### Use broom::glance() to get output of model fit & statistical significance

```{r}
penguin_lm_glance <- glance(penguin_lm)

penguin_lm_glance
```

### Use equatiomatic::extract_eq() to return model in LaTeX

```{r}
extract_eq(model = penguin_lm, use_coefs = TRUE)
# look at this result in Knitted document
```

$\frac{apples}{bananas}$


### Use plot() function to automatically produce diagnostic plots

```{r}
plot(penguin_lm)

# homoscedasticity - equal residual variances
# heteroscedasicity - unequal
```







